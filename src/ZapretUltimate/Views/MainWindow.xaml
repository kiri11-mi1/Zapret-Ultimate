<Window x:Class="ZapretUltimate.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ZapretUltimate.ViewModels"
        xmlns:converters="clr-namespace:ZapretUltimate.Converters"
        Title="Zapret Ultimate"
        Width="800"
        Height="750"
        MinWidth="600"
        MinHeight="500"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:BoolToColorConverter x:Key="BoolToColor"/>
        <converters:InverseBoolConverter x:Key="InverseBool"/>
    </Window.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay"
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
              Background="#80000000"
              Panel.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock Text="{Binding LoadingText}"
                           Foreground="White"
                           FontSize="14"
                           Margin="0,16,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Style="{StaticResource Card}" Margin="0,0,0,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Zapret Ultimate"
                                   FontSize="24"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource TextBrush}"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Ellipse Width="12" Height="12"
                                     Fill="{Binding IsRunning, Converter={StaticResource BoolToColor}}"
                                     Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding StatusText}"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Control Buttons -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="Запустить"
                                Style="{StaticResource AccentButton}"
                                Command="{Binding StartCommand}"
                                Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibility}, ConverterParameter=Invert}"
                                Margin="0,0,8,0"/>
                        <Button Content="Остановить"
                                Style="{StaticResource DangerButton}"
                                Command="{Binding StopCommand}"
                                Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibility}}"
                                Margin="0,0,8,0"/>
                        <Button Content="Перезапустить"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding RestartCommand}"
                                Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibility}}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Configs List -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Categories}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource Card}" Margin="0,0,0,8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="{Binding Name}"
                                               FontSize="15"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource TextBrush}"
                                               VerticalAlignment="Center"
                                               Margin="0,0,16,0"/>
                                    <ComboBox Grid.Column="1"
                                              Style="{StaticResource ConfigComboBox}"
                                              ItemContainerStyle="{StaticResource ConfigComboBoxItem}"
                                              ItemsSource="{Binding Configs}"
                                              SelectedItem="{Binding SelectedConfig, Mode=TwoWay}"
                                              DisplayMemberPath="DisplayName"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Settings Panel -->
            <Border Grid.Row="2" Style="{StaticResource Card}" Margin="0,16,0,0">
                <StackPanel>
                    <!-- Autostart (always visible) -->
                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Автозапуск" FontWeight="Medium"/>
                            <TextBlock Text="Запускать при входе в Windows"
                                       FontSize="12"
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                        <ToggleButton Grid.Column="1"
                                      Style="{StaticResource ToggleSwitch}"
                                      IsChecked="{Binding AutoStartEnabled, Mode=TwoWay}"/>
                    </Grid>

                    <!-- Advanced Settings (collapsed by default) -->
                    <Expander Style="{StaticResource SettingsExpander}">
                        <Expander.Header>
                            <TextBlock Text="Дополнительно"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </Expander.Header>
                        <StackPanel Margin="0,8,0,0">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="IPSet Global" FontWeight="Medium"/>
                                    <TextBlock Text="Фильтрация по IP-адресам"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                                <ToggleButton Grid.Column="1"
                                              Style="{StaticResource ToggleSwitch}"
                                              IsChecked="{Binding IpsetGlobalEnabled, Mode=TwoWay}"/>
                            </Grid>

                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="IPSet Gaming" FontWeight="Medium"/>
                                    <TextBlock Text="IP-фильтр для игр"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                                <ToggleButton Grid.Column="1"
                                              Style="{StaticResource ToggleSwitch}"
                                              IsChecked="{Binding IpsetGamingEnabled, Mode=TwoWay}"/>
                            </Grid>

                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Показывать логи" FontWeight="Medium"/>
                                    <TextBlock Text="Окна процессов winws"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                                <ToggleButton Grid.Column="1"
                                              Style="{StaticResource ToggleSwitch}"
                                              IsChecked="{Binding ShowLogs, Mode=TwoWay}"/>
                            </Grid>

                            <Button Content="Сбросить настройки сети"
                                    Style="{StaticResource SecondaryButton}"
                                    Command="{Binding ResetNetworkCommand}"
                                    HorizontalAlignment="Left"
                                    Padding="16,8"/>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
